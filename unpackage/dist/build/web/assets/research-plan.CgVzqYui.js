import{g as r,m as e}from"./index-E3agI9Tn.js";const o=async o=>{if(console.log("开始创建研究方案..."),!o)throw console.error("缺少方案数据"),new Error("缺少方案数据");console.log("方案数据大小约:",JSON.stringify(o).length,"字节");const t=r("userId");if(!t)throw console.error("用户未登录"),new Error("用户未登录");try{console.log("调用云函数创建研究方案...");const r=await e.callFunction({name:"research-plan-service",data:{action:"create",userId:t,planData:o}});if(console.log("云函数返回原始结果:",r),!r||!r.result)throw console.error("云函数返回结果无效"),new Error("创建研究方案失败: 服务器返回无效");if(200!==r.result.code)throw console.error("创建失败，错误码:",r.result.code,"错误信息:",r.result.message),new Error(r.result.message||"创建研究方案失败");if(!r.result.data){console.error("云函数返回的结果中缺少data字段");const r={...o,_id:o.clientId||`fallback_${Date.now()}`};return console.log("使用备用数据:",r),r}return console.log("返回的方案数据结构:"),Object.keys(r.result.data).forEach((e=>{console.log(` - ${e}: ${typeof r.result.data[e]}`)})),r.result.data._id||(console.warn("返回数据中缺少_id字段"),r.result.data.id?(console.log('找到替代ID字段 "id":',r.result.data.id),r.result.data._id=r.result.data.id):o.clientId?(console.log("使用客户端生成的ID:",o.clientId),r.result.data._id=o.clientId):(console.log("生成一个新的临时ID"),r.result.data._id=`temp_${Date.now()}_${Math.random().toString(36).substring(2,10)}`)),console.log("成功创建方案，最终使用的ID:",r.result.data._id),r.result.data}catch(s){console.error("创建研究方案出现错误:",s);const r={...o,_id:o.clientId||`error_${Date.now()}`,error:s.message||"未知错误"};throw console.log("返回带错误信息的备用数据:",r),s}},t=async(o=1,t=10)=>{console.log("获取研究方案列表, 页码:",o,"每页数量:",t);const s=r("userId");if(!s)throw console.error("用户未登录"),new Error("用户未登录");try{console.log("调用云函数获取研究方案列表...");const r=await e.callFunction({name:"research-plan-service",data:{action:"list",userId:s,page:o,pageSize:t}});if(console.log("云函数响应结果:",r),!r||!r.result)throw console.error("云函数响应无效"),new Error("获取研究方案列表失败: 无效的响应");if(200!==r.result.code)throw console.error("获取研究方案列表失败, 错误码:",r.result.code,"错误信息:",r.result.message),new Error(r.result.message||"获取研究方案列表失败");return r.result.data?(console.log("研究方案列表获取成功:",r.result.data),r.result.data):(console.error("研究方案列表数据为空"),{list:[],total:0,totalPages:1,page:o,pageSize:t})}catch(l){throw console.error("获取研究方案列表失败:",l),l}},s=async r=>{if(console.log("获取研究方案详情, ID:",r),!r)throw console.error("缺少方案ID"),new Error("缺少方案ID");try{console.log("调用云函数获取研究方案详情...");const o=await e.callFunction({name:"research-plan-service",data:{action:"get",planId:r}});if(console.log("云函数响应结果:",o),!o||!o.result)throw console.error("云函数响应无效"),new Error("获取研究方案详情失败: 无效的响应");if(200!==o.result.code)throw console.error("获取研究方案详情失败, 错误码:",o.result.code,"错误信息:",o.result.message),new Error(o.result.message||"获取研究方案详情失败");if(!o.result.data)throw console.error("研究方案数据为空"),new Error("研究方案不存在或已被删除");return console.log("研究方案数据获取成功:",o.result.data),o.result.data}catch(o){throw console.error("获取研究方案详情失败:",o),o}},l=async()=>{console.log("根据用户ID获取研究方案");const o=r("userId");if(!o)throw console.error("用户未登录"),new Error("用户未登录");try{console.log("调用云函数获取用户研究方案...");const r=await e.callFunction({name:"research-plan-service",data:{action:"getByUser",userId:o}});if(console.log("云函数响应结果:",r),!r||!r.result)throw console.error("云函数响应无效"),new Error("获取研究方案失败: 无效的响应");if(200!==r.result.code)throw console.error("获取研究方案失败, 错误码:",r.result.code,"错误信息:",r.result.message),new Error(r.result.message||"获取研究方案失败");return r.result.data&&0!==r.result.data.length?(console.log("用户研究方案获取成功:",r.result.data),r.result.data):(console.log("用户没有研究方案"),[])}catch(t){throw console.error("获取用户研究方案失败:",t),t}},a=async(r,o)=>{if(console.log("更新研究方案:",{planId:r,planData:o}),!r||!o)throw new Error("缺少必要参数");try{const t=await e.callFunction({name:"research-plan-service",data:{action:"update",planId:r,planData:o}});if(console.log("更新研究方案结果:",t),200!==t.result.code)throw new Error(t.result.message||"更新研究方案失败");return t.result.data}catch(t){throw console.error("更新研究方案失败:",t),t}},n=async r=>{if(console.log("删除研究方案:",r),!r)throw new Error("缺少方案ID");try{const o=await e.callFunction({name:"research-plan-service",data:{action:"delete",planId:r}});if(console.log("删除研究方案结果:",o),200!==o.result.code)throw new Error(o.result.message||"删除研究方案失败");return!0}catch(o){throw console.error("删除研究方案失败:",o),o}};export{s as a,l as b,o as c,n as d,t as g,a as u};
