import{q as e,r as t,v as a,c as s,w as l,i as n,o,a as c,b as i,d as A,e as u,F as r,t as d,x as f,f as m,p as v,S as h,I as p,y as g,z as j,j as w}from"./index-DKAPyHqU.js";import{_ as X}from"./_plugin-vue_export-helper.BCo6x5W8.js";const _="https://spark-api-open.xf-yun.com/v1/chat/completions",y="dtYdOHqILkDntsTnfPSS:FHYYBjzLggbTmjjNjYBD",B=(e,t,a={})=>(async(e,t,a={})=>{var s,l,n;const o=await fetch(_,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${y}`},body:JSON.stringify({model:"lite",messages:e,stream:!0,...a})});if(!o.ok){const e=await o.json().catch((()=>({})));throw new Error((null==(s=e.error)?void 0:s.message)||`HTTP ${o.status}`)}const c=o.body.getReader(),i=new TextDecoder("utf-8");let A="";try{for(;;){const{done:e,value:a}=await c.read();if(e)break;A+=i.decode(a,{stream:!0});const s=A.split(/\r?\n/);A=s.pop()||"";for(const o of s){const e=o.trim();if(e){if("data:[DONE]"===e)return void t("",!0);if(e.startsWith("data:"))try{const a=e.substring(5).trim(),s=JSON.parse(a);if(0!==s.code)throw new Error(s.message||`API错误: ${s.code}`);const o=(null==(n=null==(l=s.choices[0])?void 0:l.delta)?void 0:n.content)||"";o&&t(o,!1)}catch(u){console.error("解析错误:",u.message),console.error("原始数据:",e)}}}}}finally{c.releaseLock()}})([{role:"user",content:e}],t,a),k=X({__name:"chat",setup(X){const _=e=>{const t=new Date(e);return`${t.getHours().toString().padStart(2,"0")}:${t.getMinutes().toString().padStart(2,"0")}`},y=e([{id:1,title:"新对话1",time:Date.now(),type:"chat"},{id:2,title:"文档分析",time:Date.now()-36e5,type:"doc"}]),k=e({id:1}),C=e([]),O=t(""),Q=t([]),x=t(!1),E=t(0),Y=a((()=>(O.value.trim()||Q.value.length)&&!x.value)),H=()=>{const e={id:Date.now(),title:`新对话${y.length+1}`,time:Date.now(),type:"chat"};y.unshift(e),U(e.id)},U=e=>{const t=y.find((t=>t.id===e));Object.assign(k,t),C.splice(0)},L=async()=>{if(!Y.value)return;const e={role:"user",content:O.value,files:[...Q.value],time:Date.now()};C.push(e),x.value=!0;const t={role:"assistant",content:"",thinking:!0,time:Date.now()};C.push(t),O.value="",Q.value=[],M();try{console.log("发送的信息:",e.content),await B(e.content,((e,t)=>{C[C.length-1].thinking&&C.pop();const a=C[C.length-1];"assistant"!==(null==a?void 0:a.role)||a.thinking?C.push({role:"assistant",content:e,time:Date.now()}):a.content+=e,M()}))}catch(a){C.pop(),C.push({role:"assistant",content:"请求失败，请检查网络或API配置"+a.message,time:Date.now()})}finally{x.value=!1,M()}},b=()=>{document.querySelector(".hidden-input").click()},G=e=>{Q.value=[...Q.value,...Array.from(e.target.files)]},M=async()=>{await f(),E.value=Date.now()};return(e,t)=>{const a=m,f=v,X=n,B=h,M=w,S=p;return o(),s(X,{class:"container"},{default:l((()=>[c(X,{class:"sidebar"},{default:l((()=>[c(X,{class:"header"},{default:l((()=>[c(a,{class:"logo"},{default:l((()=>[i("EduResearch")])),_:1}),c(f,{class:"new-chat",onClick:H},{default:l((()=>[c(a,null,{default:l((()=>[i("+ 新对话")])),_:1})])),_:1})])),_:1}),c(B,{class:"history-list","scroll-y":""},{default:l((()=>[(o(!0),A(r,null,u(y,(e=>(o(),s(X,{key:e.id,class:g(["history-item",{active:k.id===e.id}]),onClick:t=>U(e.id)},{default:l((()=>[c(X,{class:"item-icon"},{default:l((()=>[i(d("doc"===e.type?"📄":"💬"),1)])),_:2},1024),c(X,{class:"item-info"},{default:l((()=>[c(a,{class:"title"},{default:l((()=>[i(d(e.title),1)])),_:2},1024),c(a,{class:"time"},{default:l((()=>[i(d(_(e.time)),1)])),_:2},1024)])),_:2},1024)])),_:2},1032,["class","onClick"])))),128))])),_:1})])),_:1}),c(X,{class:"main"},{default:l((()=>[c(B,{class:"message-list","scroll-y":"","scroll-top":E.value},{default:l((()=>[(o(!0),A(r,null,u(C,((e,t)=>(o(),s(X,{key:t,class:g(["message",e.role])},{default:l((()=>[c(M,{class:"avatar",src:"user"===e.role?"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAFHSURBVHgB7ZbBDcIwDESfkQpQA6oBNdABHdABHdABJdABHdABHdABJXh5iiNZJ7vEQuojPd1JtvNjO3ECAAAAAAAAAAAAAADAiXjvH1rrO6XUjTF2j9bOuaeU8hGtKaUuY4yXGf3wJcVxH3Rwzt2klHfO8YJQ1nH3MqOfvqQ47oMOzrmblPLOOV4QyjruXmb005cUx33QwTl3k1LeOccLQlnH3cuMfvqS4rgPOjjnblLKO+d4QSjruHuZ0U9fUhz3QQfn3E1Keecch5DkXqy1NxH6M3r1bqgvTjC6a4y5i9C/0Kt3Q31xgtFdY8xdhP6FXr0b6osTjO4aY+4i9C/06t1QX5xgdNcYcxehf6FX74b64gSju8aYuwj9C716N9QXJxjdNcbcRehf6NW7ob44weiuMeYuQv9Cr94N9cUJRneNMXcR+hd69W6oL04wumuMuYvQv9Crd0N9cYLRXWPMXYT+hV69G+qLE4zuGmPuIvQv9OrdUF+cYHTXGHMXoX+hV++G+uIEo7vGmLsI/Qu9ejfUFycY3TXG3EXoX+jVu6G+OMHorjHmLkL/AiMpxmE9Vw1xAAAAAElFTkSuQmCC":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IARs4c6QAAAARnQU1BAACxjwv8YQUAAAHSSURBVHgB7ZdBDsIgEEWn7v8C3bgx7o0X6M0L6AIv4Ma4Ny7wAnoBvUA3JtE0TQUhDAX8L5nJcCjTj58OQwEAAAAAAAAAAAAAACqklHpK6YoxXrXWx7X6KaUzxnjWWm+klF4xL0Z7eXHcBx2EEGcM5J0Y4wWhrOPuZUY/fUlx3AcdhBBnDOSdGOMFoazj7mVGP31JcdwHHYQQZwzknRjjBaGs4+5lRj99SXHcBx2EEGcM5J0Y4wWhrOPuZUY/fUlx3AcdhBBnDOSdGONFq9Wr1vomQv9Br94N9cUJRneNMXcR+hd69W6oL04wumuMuYvQv9Crd0N9cYLRXWPMXYT+hV69G+qLE4zuGmPuIvQv9OrdUF+cYHTXGHMXoX+hV++G+uIEo7vGmLsI/Qu9ejfUFycY3TXG3EXoX+jVu6G+OMHorjHmLkL/Qq/eDfXFCUZ3jTF3EfoXevVuqC9OMLprjLmL0L/Qq3dDfXGC0V1jzF2E/oVevRvqixOM7hpj7iL0L/Tq3VBfnGB01xhzF6F/oVfvhvriBKO7xpi7CP0LvXo31BcnGN01xtxF6F/o1buhvjjB6K4x5i5C/wIjjcVhOVkOcQAAAABJRU5ErkJggg=="},null,8,["src"]),c(X,{class:"bubble"},{default:l((()=>[e.thinking?(o(),s(a,{key:0,class:"typing"},{default:l((()=>[c(a,{class:"dot"},{default:l((()=>[i("●")])),_:1}),c(a,{class:"dot"},{default:l((()=>[i("●")])),_:1}),c(a,{class:"dot"},{default:l((()=>[i("●")])),_:1})])),_:1})):(o(),s(a,{key:1},{default:l((()=>[i(d(e.content),1)])),_:2},1024)),e.files?(o(),s(X,{key:2,class:"files"},{default:l((()=>[(o(!0),A(r,null,u(e.files,((e,t)=>(o(),s(X,{key:t,class:"file"},{default:l((()=>[c(a,{class:"icon"},{default:l((()=>[i("📎")])),_:1}),c(a,{class:"name"},{default:l((()=>[i(d(e.name),1)])),_:2},1024)])),_:2},1024)))),128))])),_:2},1024)):j("",!0),c(a,{class:"time"},{default:l((()=>[i(d(_(e.time)),1)])),_:2},1024)])),_:2},1024)])),_:2},1032,["class"])))),128))])),_:1},8,["scroll-top"]),c(X,{class:"input-area"},{default:l((()=>[c(X,{class:"file-tags"},{default:l((()=>[(o(!0),A(r,null,u(Q.value,((e,t)=>(o(),s(X,{key:t,class:"tag"},{default:l((()=>[c(a,null,{default:l((()=>[i(d(e.name),1)])),_:2},1024),c(a,{onClick:e=>(e=>{Q.value.splice(e,1)})(t),class:"remove"},{default:l((()=>[i("×")])),_:2},1032,["onClick"])])),_:2},1024)))),128))])),_:1}),c(X,{class:"input-box"},{default:l((()=>[c(X,{onClick:b,class:"file-btn"},{default:l((()=>[i("📁")])),_:1}),c(S,{modelValue:O.value,"onUpdate:modelValue":t[0]||(t[0]=e=>O.value=e),placeholder:"输入消息...",onConfirm:L,class:"input"},null,8,["modelValue"]),c(f,{onClick:L,disabled:!Y.value,class:"send-btn"},{default:l((()=>[i(d(x.value?"发送中...":"发送"),1)])),_:1},8,["disabled"])])),_:1}),c(S,{type:"file",ref:"fileInput",onChange:G,class:"hidden-input",multiple:""},null,512)])),_:1})])),_:1})])),_:1})}}},[["__scopeId","data-v-3eaf8240"]]);export{k as default};
